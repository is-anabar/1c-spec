# Билет 5 (занятия ...)


Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, т.е. совместительство допускается. 

Каждый сотрудник компании работает по своему собственному графику. При одновременной работе в разных подразделениях у каждого сотрудника в конкретном подразделении может быть собственный график. Если сотрудник опоздал на работу, то за каждые целые 15 минут опоздания начисляется штраф в размере 5 рублей.

Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в часах. Сумма начисления по окладу определяется как начальное значение оклада, деленное на количество рабочих часов в том же периоде, что и фактически отработанные часы. Начальное значение оклада одинаково для всех сотрудников конкретного подразделения и должно быть определено по специальной шкале в зависимости от отработанного времени, которая вводится пользователем в режиме 1С: Предприятия. Например:


|Подразделение	  |Фактически отработанные часы   |Оклад  |
|-------------------|-------------------------------|---------------|
|Отдел внедрения 	|до 60		  				|3000		  |
|Отдел внедрения	|от 60 до 130					|4000			 |
|Отдел внедрения	|от 130 						|50000			 |
|Бухгалтерия		|до 50							|2500			 |
|Бухгалтерия		|от 50 до 150					|3500			 |
|Бухгалтерия		|от 150							|4500			 |

Дополнительно, сотрудникам компании выплачивается надбавка, рассчитываемая как общая сумма продаж товаров за предыдущий месяц по подразделению, в котором работает сотрудник, умноженная на определенный процент. Сумма продаж по подразделению должна быть получена по данным бухгалтерского учета. Значение процента надбавки может быть задано в документе «Начисление зарплаты». 

Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.

Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:
Месяц: Июнь 2012 г.

<table>
  <tr>
	<th rowspan="2">Подразделение</th>
	<th rowspan="2">Сотрудник</th>
	<th rowspan="2">Вид расчета</th>
	<th colspan="2">Начисление по окладу</th>
	<th colspan="2">Начислено от продаж</th>
	<th rowspan="2">Итого (Сумма)</th>
  </tr>
  <tr>
	<th>Отработано (час)</th>
	<th>Сумма</th>
	<th>%</th>
	<th>Сумма</th>
  </tr>
  <tr>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
  </tr>
  <tr>
	<td>Итого: </td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
	<td></td>
  </tr>
</table>


## Регистр сведений ТарифнаяСтавка
- добавляем измерения `Подразделение` (обязательное), `ЧасовОт` и `ЧасовДо` (обязательный)
- добавляем ресурс `Оклад`


## Регистр сведений Графики работы

- Измерения:
	- Дата - `дата и время` (для учета времени 8:15, например)
	- График работы 
- Ресурсы:
	- Часов (будет по 0.25)
	- Пятнадцатиминуток (0 или 1)


## Обработка ЗаполнениеГрафика

- Исправить заполнение графика: заполнять по 0.25 часов рабочего дня и по 1 15-минутке в рабочие дни
- Начинать заполнение нужно с 8:15 до 16:00 включительно. 
	> Если начинать с 8:00, то за 45 минут позданий начислиться 4 по 15 (т.е. час)


## Планы видов расчета

### ПВР Основные начисления

- Вкладка `Расчеты`:
	- `Использует период действия` (с какого по какое оклад и штраф)
	- `Зависит по периоду действия` - нет
- Элементы:
	- Оклад
		- Вытесняющие: Штраф
	- Штраф

###  ПВР Дополнительные начисления
- Вкладка `Расчеты`:
	- `Использует период действия`- нет
	- `Зависит по периоду действия` - нет
- Элементы:
	- Премия

> Как мне кажется, здесь нет смысла ставить зависимость по периоду действия. Основу для начислений получаем из регистра бухгалтерии, а базовый период всегда можно рассчитать для каждого документа отдельно.


## Регистры расчета

### РР Основные начисления

- устанавливаем `Период действия`- да, заполняем поля
- устанавливаем `Базовый период` - нет
- Измерения:
	- Сотрудник
	- Подразделение
- Ресурсы:
	- Результат
- Реквизиты 
	- для рассчета оклада:
		- Оклад
		- Часов факт
		- Часов план
	- для расчета штрафа:
		- Количество15
		- Размер штрафа


### РР Дополнительные начисления

- устанавливаем `Период действия`- нет
- устанавливаем `Базовый период` - да, заполняем поля
- Измерения:
	- Сотрудник
	- Подразделение
- Ресурсы:
	- Результат
- Реквизиты 
	- для рассчета премии:
		- Процент
		- Сумма продаж


##  Документ НачислениеЗарплаты

`Оперативное проведение` - **Запретить**.

Добовляем табличную часть `ДополнительныеНачисления`:
- Сотрудник
- Подразделение
- Процент

Изменения в ТЧ `ОсновныеНачисления`
- Добавляем колонки:
	- Подразделение
	- График работы
- выставляем дату начала и дату окончания с типом `Дата и время`


### Запись движений

Пробегаем по всем ТЧ документа:
- ТЧ `Основные начисления` переносим
	- когда заполняем `КонецПериодаДействия`, то записыыаем
	```1c
	Движение.КонецПериодаДействия = Строка.ДатаОкончания;
	// обычно пишем
	// Движение.КонецПериодаДействия = КонецДня(Строка.ДатаОкончания);
	```
- ТЧ `ДополнительныеНачисления`переносим


### Начисление оклада

Стандартное начисление ЗП с учетом отработанных часов по тарифной ставке.

Чтобы правильно получить данные по тарифной ставке и не потерять записи, соединяемся по отработанным часам в условии `ПО`, а не `ГДЕ`.

Для каждого штрафа нужно еще отнимать сумму в зависимости от пропущенного времени.

### Начисление надбавки

Для получения суммы продаж:
- Получаем из движений номер строки, подразделение и процент надбавки
- Соединяемся с `ОборотыДтКт` (лучше с этим, т.к. нужна определенная проводка)

