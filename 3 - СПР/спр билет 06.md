## Билет 6 (занятия 83 - 86)


Начисление зарплаты сотрудникам авто предприятия осуществляется ежемесячно с использованием метода отклонений. Сотрудники работают на автомобилях предприятия, поэтому возможен обмен автомобилями между водителями. 

Все сотрудники работают по графику работы, установленному для каждого автомобиля отдельно.

Не зависимо от отработанного времени сотрудникам предприятия ежемесячно выплачивается фиксированная сумма денег. Размер суммы одинаков для всех сотрудников и не меняется в течение расчетного периода.

Сотруднику предприятия выплачивается надбавка, рассчитываемая как общая сумма оплат пассажиров за прошлый месяц, полученная сотрудником, умноженная на определенный процент. Считать, что после расчета сумма оплат корректировке не подлежит. Значение процента для надбавки может изменяться не чаще, чем один раз в месяц. В информационной базе необходимо хранить историю его изменения. 

Один календарный месяц в году сотрудникам предоставляется оплачиваемый отпуск, размер которого определяется как количество дней отпуска, умноженное на среднюю дневную ставку.

Дни отпуска рассчитываются по пятидневному графику. Средняя дневная ставка определяется как сумма всех начислений за три предыдущих месяца /на кол-во рабочих дней за пред. 3 месяца. Следует учесть, что данные об отпуске не могут вводиться в систему задним числом. 
Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетом периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклада: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.

Создать отчет «Перерасчеты зарплаты», в котором пользователь должен увидеть записи регистра расчета, которые возможно требуется пересчитать. Обратите внимание, в отчете должна отражаться также информация о необходимости перерасчета надбавки при исправлении суммы оплат пассажиров. Колонки Объект перерасчета, Вид расчета, …

Саму процедуру перерасчета записей в рамках данной задачи реализовывать не требуется.

Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:

Период март 2012 – июнь 2012г.

|Автомобиль |Сотрудник |Вид расчета |Период 1 |Период 2 |… |
|--------------|----------|------------|---------|---------|--|
|Итого:													   |


### Примечание

Здесь идёт рассчет на то, что автомобили ~ графики работы, поэтому автомобиль будет в ресурсах, а не реквизитах.



### Создаем справочник Автомобили


### Создаем регистр сведений ПроцентыНадбавок:
- ресурс ПроцентНадбавки


### Регистр сведений ГрафикиРаботы:
- Добавляем измерение Автомобиль
- Переименовать реквизит Значение в Дней
- Добавить ресурс ДнейПятидневики (для расчета отпуска) 

### Обработка ЗаполнениеГрафика
- Исправить заполнение графика: заполняем ДнейПятидневки

### План видов расчета ОсновныеНачисления:
- Добавляем Отпуск
- На вкладке `Базовые` выбираем всё
- Выставляем на вкладке Расчеты флаги:
	- ИспользуетПериодДействия (с какого по какое отпуск) 
	- Зависит по периоду действия - ОсновныеНачисления и ДополнительныеНачисления (для получения основы для расчета)

### План видов расчета ДополнительныеНачисления:
- Добавляем Надбавка и ФиксированнаяСумма
- Выставляем на вкладке Расчеты флаги:
	- ИспользуетПериодДействия - нет
	- Зависит по периоду действия - нет

### Регистр расчета ОсновныеНачисления:
- На вкладке Основная выставляем флаги:
	- Период действия, заполняем поля
	- Базовый период, заполняем поля
- Добавляем реквизиты `Автомобиль, ЧасовФакт и ЧасовПлан, ОсноваДляВыплат`

### Регистр расчета ДополнительныеНачисления:
- На вкладке Основная выставляем флаги:
	- Период действия - нет
	- Базовый период - нет
- Добавляем реквизиты `ОсноваДляРасчетаПремии, ПроцентПремии`

###  Документ НачислениеЗарплаты:
- Оперативное проведение - Запретить
- в ТЧ ОсновныеНачисления добавляем поле ГрафикРаботы
- Добавляем табличную часть для дополнительных начислений
	- В ТЧ ДополнительныеНачисления добавить ОсноваДляВыплат (типо сколько клиенты оплатили за прошлый месяц; не хочется делать лишний документ и регистр)


1. Записываем все движения (в т.ч. сторно)
Пробегаем по всем ТЧ документа:
- `Основные начисления` переносим, заполняем **базовый период** (для каждой строки - три предыдущих месяца месяц)
- ТЧ дополнительных начислений переносим

2. Начисление отпуска - стандартное:

Для получение основы для расчета отпуска:
- `ДанныеГрафика.ДнейПятидневкиФактическийПериодДействия` - для расчета, сколько дней пятидневки должны были отработать
- `БазаОсновныеНачисления.РезультатБаза + БазаДополнительныеНачисления.РезультатБаза` - для расчета основы для выплат
- `ДанныеГрафика.ДнейБазовыйПериод` - сколько дней отработано за предыдущие 3 месяца

3. Расчет дополнительных штук:
- Берем данные из `ДополнительныеНачисления`
- Соединяемся с РС ПроцентыНадбавок (по ИСТИНА, т.к. на дату будет только 1 запись)

4. Перерасчеты:
- Создаем для основных начислений
- Измерения перерасчета такие же, как и у регистра расчета
- Измерение регистра - какое измерение в текущем РР, ДанныеВедущихРегистров - какое измерение из базы
