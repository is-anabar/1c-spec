## Билет 11 (занятия 110 - 111) 

Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.

Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.

Количество фактически отработанных часов вводится в систему с помощью документа «Табель», Документ должен заполняться на список сотрудников только определенного подразделения. Для каждого сотрудника, на каждый день месяца, вводится количество фактически отработанных часов на основном месте работы.

Затем в задании будет представлен внешний вид формы табеля.
На форме в шапке документа поля «Номер», «Дата», «Подразделение».
Ниже табличная часть. В ней колонки «Сотрудник» и «1», «2», «3»...
В колонке «Сотрудник» отображается список сотрудников, а на пересечении сотрудника и дня месяца один из трех вариантов: «8», «К» либо пустое поле.

Сотрудники предприятия получают оплату по часовому тарифу. Сумма начисления по тарифу определяется как тарифная ставка, умноженная на количество фактически отработанных часов. В течение расчетного периода тарифная ставка может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.

Дополнительно, сотрудникам компании должна быть начислена премия процентом от начисленного в том же расчетном периоде оклада. Процент премии должен храниться в информационной базе и не меняется в течение периода начисления и задается в документе «Начисление зарплаты».

Невыход сотрудника на работу должен быть зафиксирован в информационной базе, но не оплачен.

Механизм перерасчетов в рамках данной задачи использовать не надо.

Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление по тарифу с 10.01 но 31.01, а запись: тариф с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.

Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:

|Подразделение |Сотрудник |Вид расчета |Период 1 |Период 2 |… |
|--------------|----------|------------|---------|---------|--|
|Итого:													   |

Отчет может быть построен за любой расчетный период. 


### Подразделения

Т.к. есть **совместительство**, то заводим `Подразделение` в документе `НачислениеЗарплаты` (ТЧ Основная), регистре сведений `СведенияОСотрудниках`, регистре расчета `ОсновныеНачисления`


### Графики работы
Создаем справочник **ГрафикиРаботы**

### Регистр сведений **ГрафикиРаботы**

- Добавить измерение `ГрафикРаботы`
- Переименовать `Значение` в `Часов` 

### Обработка **ЗаполнениеГрафика**

- исправить заполнение графика: заполняем "ГрафикРаботы", "Часов"


### Регистр сведений ТарифнаяСтавка

- можно переименовать СведенияОСотрудниках


### План видов расчета **ОсновныеНачисления**

- Добавляем `Невыход`
- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` (с какого по какое оклад и невыход)
	- `Зависит по периоду действия` - нет

### План видов расчета **ДополнительныеНачисления**

- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` - нет
	- `Зависит по периоду действия` - "ОсновныеНачисления" (какие начиления являются основой для премии)


### Регистр расчета **ОсновныеНачисления**

- устанавливаем `Период действия`- да, заполняем поля
- устанавливаем `Базовый период` - да
- стандартные измерение `Сотрудник` и ресурсы `Результат`
- Добавляем реквизиты: `ГрафикРаботы, ЧасовФакт, ТарифнаяСтавка` (для оклада)


### Регистр расчета **ДополнительныеНачисления**

- устанавливаем `Период действия`- нет
- устанавливаем `Базовый период` - да
- стандартные измерение `Сотрудник` и ресурсы `Результат`
- Добавляем реквизиты: `ОсноваДляНачислений, ПроцентПремии`


### Регистр накопления (оборотный) **ДанныеТабеля**

- измерения `Сотрудник, Подразделение, ВидРасчета`
- ресурсы `Часов`


### Документ **Табель**

Заводим табличную часть, где в колонках будет:
- Сотрудник
- День1 ... День31 (строка)

При проведении документа:
- определяем дней в месяце - с помощью `День(<КонецМесяца>)`
- по виду записи (пусто, 8 или Н) определяем вид начисления и записываем строку в РН `ДанныеТабеля`:
	- для пусто - никаких записей
	- 8 - оклад
	- Н - невыход


### Документ **НачислениеЗарплаты**

- `Оперативное проведение` - **Запретить**
- в ТЧ "ОсновныеНачисления" добавляем поле "ГрафикРаботы"
- добавляем ТЧ для дополнительных начислений


1. Записываем все движения
Пробегаем по всем ТЧ документа:
- `Основные начисления` переносим.
- `Дополнительные начисления` переносим. Для вида расчета `Премия`:
	- заполняем **базовый период** (для каждой строки - текущий месяц)

2. Расчет оклада

- получить данные движений для оклада (здесь не используется плановые часы. это нужно только для отбора по ссылке + сотруднику + подразделению в дальнейшем)
- соединиться с:
	- данными табеля - обороты за месяц (по подразделению + сотруднику, виду часов)
	- с данными по тарифной ставке (по подразделению + сотруднику)

Далее рассчет результата стандартный.


3. Фиксирование невыхода

- получить данные движений для оклада (здесь не используется плановые часы. это нужно только для отбора по ссылке + сотруднику + подразделению в дальнейшем)
- соединиться с:
	- данными табеля - обороты за месяц (по подразделению + сотруднику, виду часов)

Просто переносим часы невыхода в `ЧасовФакт`


4. Расчет премии
Стандартный расчет премии

