## Билет 14 (112)

`Билет аналогичен билету 11`. Здесь нет невыхода и чуток другой механизм расчета премии.

Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно. Каждый сотрудник может работать одновременно в нескольких подразделениях компании, то есть совместительство допускается.

Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.

Количество фактически отработанных часов вводится в систему с помощью документа «Табель». Документ должен заполняться еженедельно на весь список сотрудников компании. Для каждого сотрудника каждый отработанный день недели отмечается флажком в табличной части документа.

Затем в задании будет представлен внешний вид формы табеля.
На форме в шапке документа поля: «Номер», «Дата».
Ниже следующие поля: «Период с:» 01.01.2013 «Период по:» 07.01.2013
Ниже табличная часть. В ней колонки «Сотрудник» и «Д1», «Д2», «Д3», «Д4», «Д5», «Д6», «Д7».
В колонке «Сотрудник» отображается список сотрудников, а на пересечении сотрудника и дня недели поля флага, на некоторых днях флаг установлен, на других нет.

Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в днях. Дневная ставка рассчитывается как начальное значение оклада, деленное на количество рабочих дней в том же периоде, что и фактически отработанные дни. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.

Дополнительно, каждому сотруднику компании может быть начислена премия в виде процента от суммы окладов всех сотрудников его подразделения за текущий месяц. Процент премии в течение периода не меняется и задается в документе “Начисление зарплаты”.

Механизм перерасчетов в рамках данной задачи использовать не надо.

Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.

Для анализа сделанных сотрудникам предприятия начислений в конфигурации необходимо предусмотреть отчет следующего вида:
|Подразделение |Сотрудник |Вид расчета |Период 1 |Период 2 |… |
|--------------|----------|------------|---------|---------|--|
|Итого:                                                       |


### Подразделения

Т.к. есть **совместительство**, то заводим `Подразделение` в документе `НачислениеЗарплаты` (ТЧ Основная), регистре сведений `СведенияОСотрудниках`, регистре расчета `ОсновныеНачисления`


### Графики работы
Создаем справочник **ГрафикиРаботы**

### Регистр сведений **ГрафикиРаботы**

- Добавить измерение `ГрафикРаботы`
- Переименовать `Значение` в `Дней` 

### Обработка **ЗаполнениеГрафика**

- исправить заполнение графика: заполняем "ГрафикРаботы", "Дней"


### Регистр сведений ТарифнаяСтавка

- можно переименовать СведенияОСотрудниках


### План видов расчета **ОсновныеНачисления**

- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` (с какого по какое оклад и невыход)
	- `Зависит по периоду действия` - нет

### План видов расчета **ДополнительныеНачисления**

- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` - нет
	- `Зависит по периоду действия` - "ОсновныеНачисления" (какие начиления являются основой для премии)


### Регистр расчета **ОсновныеНачисления**

- устанавливаем `Период действия`- да, заполняем поля
- устанавливаем `Базовый период` - да
- стандартные измерение `Сотрудник` и ресурсы `Результат`
- Добавляем реквизиты: `ГрафикРаботы, ДнейФакт, ТарифнаяСтавка` (для оклада)


### Регистр расчета **ДополнительныеНачисления**

- устанавливаем `Период действия`- нет
- устанавливаем `Базовый период` - да
- стандартные измерение `Сотрудник` и ресурсы `Результат`
- Добавляем реквизиты: `ОсноваДляНачислений, ПроцентПремии`


### Регистр накопления (оборотный) **ДанныеТабеля**

- измерения `Сотрудник, Подразделение, ВидРасчета`
- ресурсы `Дней`


### Документ **Табель**

Заводим табличную часть, где в колонках будет:
- Сотрудник
- День1 ... День7 (строка)

При проведении документа:
- определяем дней в месяце - с помощью `День(<КонецМесяца>)`
- если в поле `День...` стоит флажок, то делаем запись в регистр и ставим оклад


### Документ **НачислениеЗарплаты**

- `Оперативное проведение` - **Запретить**
- в ТЧ "ОсновныеНачисления" добавляем поле "ГрафикРаботы"
- добавляем ТЧ для дополнительных начислений


1. Записываем все движения
Пробегаем по всем ТЧ документа:
- `Основные начисления` переносим.
- `Дополнительные начисления` переносим. Для вида расчета `Премия`:
    - заполняем **базовый период** (для каждой строки - текущий месяц)

2. Расчет оклада

- получить данные движений для оклада (здесь не используется плановые дни. это нужно только для отбора по ссылке + сотруднику + подразделению в дальнейшем)
- соединиться с:
    - данными табеля - обороты за месяц (по подразделению + сотруднику, виду дней)
    - с данными по тарифной ставке (по подразделению + сотруднику)

Далее рассчет результата стандартный.


4. Расчет премии

Для получения премии берем данные из `БазаОсновныеНачисления`. Чтобы получить данные по подразделению, в качестве `Измерения` передаем только `Подразделение`

