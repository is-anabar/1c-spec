## Билет 1 (занятия 66-69, 70)

Начисление зарплаты сотрудникам предприятия осуществляется ежемесячно с использованием метода отклонений. Каждый сотрудник может работать одновременно только в одном подразделении компании, то есть совместительство не допускается.
Все сотрудники работают по пятидневному графику работы, однако в решении необходимо предусмотреть возможность работы по нескольким различным графикам.

Сотрудники предприятия получают оплату по окладу пропорционально отработанному времени в днях. Дневная ставка рассчитывается как начальное значение оклада, деленное на количество рабочих дней в том же периоде, что и фактически отработанные дни. Первоначальное значение оклада может изменяться не чаще, чем один раз в день, но берется на начало расчетного периода. В информационной базе необходимо хранить историю его изменения.

Дополнительно, сотрудникам компании может быть начислена премия процентом от начисленного им за тот же период оклада. Процент премии зависит от стажа работы сотрудника на данном предприятии. Шкала значений процента премии вводится пользователем в режиме 1С:Предприятия. При решении задачи необходимо учитывать, что на момент начала ведения учета в информационной базе у сотрудника уже может быть стаж отличный от нуля. Например:

|Трудовой стаж      |Процент премии |
|-------------------|---------------|
|до 1 года          |5              |
|От 1 года до 3 лет |10             |
|От 3 лет	        |15             |

Механизм перерасчетов в рамках данной задачи использовать не надо.

В форме документа "Начисление зарплаты" необходимо предусмотреть наличие кнопки "Рассчитать", при нажатии на которую, будет произведен предварительный расчет зарплаты. Результат расчета должен быть отражен в табличной части этой же формы.

Ввод всех начислений происходит документом «Начисление зарплаты». Документ в расчетном периоде может быть один (сразу для всех видов расчета), а может быть несколько (по одному для каждого отдельного вида расчета). Считать, что все данные вводятся только в пределах одного месяца, например, можно указать начисление оклада с 10.01 по 31.01, а запись оклад: с 10.01 по 03.02 вводить нельзя. В одном документе могут быть данные только за текущий расчетный период.

Для анализа полученных сотрудниками предприятия премий в конфигурации необходимо предусмотреть отчет следующего вида:

Месяц: Июнь 2012 г.
|Сотрудник  |Трудовой стаж  |% премии   |Сумма премии|
|-----------|---------------|-----------|------------|
|           |               |           |            |
| ИТОГО:			                                 |

Отчет должен быть построен только за определенный календарный месяц.


### Подразделения

Совместительства нет, поэтому убираем подразделения там, где они есть.


### Графики работы
Создаем справочник `ГрафикиРаботы`. Добавляем предопределенные элементы `Пятидневка` (обязательно), `Смена 1, Смена 2, Смена 3` (необязательно) .


### Регистр сведений **ГрафикиРаботы**

- Добавить измерение `ГрафикРаботы`
- Переименовать `Значение` в `Дней`


### Обработка **ЗаполнениеГрафика**

- Исправить заполнение графика: заполняем "ГрафикРаботы", "Дней" 


### Справочник **ФизическиеЛица**

- добавляем реквизит `ДатаПриемаНаРаботу`


### Регистр сведений **ПроцентыЗаСТаж**
- добавляем измерения `СтажОт` и `СтажДо` (обязательный)
- добавляем ресурс `Процент`


### План видов расчета **ОсновныеНачисления**

- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` (с какого по какое оклад)
	- `Зависит по периоду действия` - нет


### План видов расчета **ДополнительныеНачисления**

- Выставляем на вкладке "Расчеты" флаги:
	- `Использует период действия` - нет
	- `Зависит по периоду действия` - "Основные начисления"


### Регистр расчета **ОсновныеНачисления**

- устанавливаем `Период действия`- да, заполняем поля
- стандартные измерение `Сотрудник` (базовое) и ресурс `Результат`
- Добавляем реквизиты `ГрафикРаботы, Оклад, ДнейФакт и ДнейПлан`
	- если при подсчете `ДнейФакт и ДнейПлан` будут показываться слишком большие цифры, то нужно установить 


### Регистр расчета *ДополнительныеНачисления**

- устанавливаем `Базовый период` - да, заполняем поля
- стандартные измерение `Сотрудник` (базовое) и ресурс `Результат`
- Добавляем реквизиты `ОсноваДляНачислений, Стаж, ПроцентПремии` 


### Документ **НачислениеЗарплаты**

- `Оперативное проведение` - **Запретить**
- в ТЧ "ОсновныеНачисления" добавляем поле "ГрафикРаботы"

1. Начисление ЗП
Стандартное начисление по отработанным дням.


2. Начисление премии
Для расчета процента премии необходимо достать дату приема сотрудника, с помощью разности дат (период регистрации и дата приема) и деления на 365 вычисляем срок работы в годах, соединяемся с `ПроцентыЗаСтаж` так, чтобы `Стаж` попал в диапазон:
```1c
РАЗНОСТЬДАТ(
    ДополнительныеНачисленияБазаОсновныеНачисления.Сотрудник.ДатаПриема, 
    &ПериодРегистрации, 
    ДЕНЬ) / 365 
КАК Стаж
ИЗ
    РегистрРасчета.ДополнительныеНачисления.БазаОсновныеНачисления(&Измерения, &Измерения, , Регистратор = &Ссылка) КАК ДополнительныеНачисленияБазаОсновныеНачисления
	    ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПроцентыПремий КАК ПроцентыПремий
	    ПО ([Стаж] >= ПроцентыПремий.СтажОт) И ([Стаж] < ПроцентыПремий.СтажДо)
```
Далее по `РезультатБаза` (ОсноваДляНачислений) получаем премию


### Отчет
- из таблицы “ДополнительныеНачисления” достаем необходимые данные
- ставим отбор по периоду регистрации (в параметрах - НачалоПериода(&Дата, "Месяц")), по виду расчета `Премия` и по премии больше 0


### Кнопка **Расчет**
- Разделяем заполнение предварительных движений и расчет зп с премией на две разные функции
- При расчете зп и премии (заполняются движения) нужно заполнять также табличные части документа
```1c
Строка = ОсновныеНачисления[Движение.НомерСтроки - 1];
ЗаполнитьЗначенияСвойств(Строка, Выборка);
Строка.Результат = Движение.Результат;

// ...

Строка = ДополнительныеНачисления[Движение.НомерСтроки - 1];
ЗаполнитьЗначенияСвойств(Строка, Выборка);
Строка.Результат = Движение.Результат;
```
- нужно очищать движения (т.к. при расчете мы еще не проводим документ) для обоих регистров
```1c
Движения.ОсновныеНачисления.Очистить();
Движения.ОсновныеНачисления.Записать();
	
Движения.ДополнительныеНачисления.Очистить();
Движения.ДополнительныеНачисления.Записать();
```
- при нажатии на кнопку необходимо проверить, что документ проведен. Далее записываются предварительные движения, рассчитывается зп и премия, заполняеются табличные части. Чтобы данные
. которые были рассчитаны в модуле объекта, появились на форме документа, необходимо выполнить
```1c
ДокОбъект = РеквизитФормыВЗначение("Объект");
ДокОбъект.ЗаполнитьДвижения(ПериодРегистрации);
ДокОбъект.РасчетЗарплатыИПремии(ПериодРегистрации); 
ЗначениеВРеквизитФормы(ДокОбъект, "Объект");
```
- при проведении документа только записываем строки из табличных частей



