## Билет 8 (занятие 115)

В компании продажами занимаются обычные менеджеры и старшие менеджеры. 

С целью дополнительного контроля при продаже в документах «Приход денег» и «Расходная накладная» может быть указан ответственный старший менеджер, контролирующий данную операцию. 

Указывать эту информацию может не каждый пользователь, а только обладающий соответствующими привилегиями. В том случае, если у пользователя отсутствуют необходимые полномочия, информация об ответственном менеджере должна быть для него не видима. Управление видимостью должно быть реализовано с помощью механизма функциональных опций. 

Следует учитывать, что права на просмотр и внесение данных об ответственном сотруднике могут меняться не чаще, чем 1 раз в день. Информация в документе должна отображаться только в том случае, если на дату документа пользователь имел соответствующие права.


### Поле **Старший менеджер**

Добавляем в реквизиты документов «Приход денег» и «Расходная накладная».


### Связывание пользователей и физических лиц
Используем [параметры сеанса](уф%20общее.md#user-and-person)


### Доступ к полю **Старший менеджер**

За основу можно взять [параметризуемые функциональные опции](уф%20общее.md#fo-params), но здесь будут небольшие отличия:

1. Создаём регистр сведений `ДоступКМенеджерам`:
    - периодический - в пределах дня
    - измерения - пользователь (физ. лицо)
    - ресурсы - доступ (булево)

2. Создаём ФО `ДоступКМенеджерам`. Связываем с ресурсом РС `ДоступКМенеджерам`.

3. Создаём параметры ФО `Пользователь`. Связываем с измерением РС `ДоступКМенеджерам`.

4. Ограничиваем видимость в зависимости от даты документа:
    - создаём форму документа (если не было)
    - в обработчике `ПриСозданииНаСервере` прописываем код:
    ```1c
    Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
        СтруктураФО = Новый Структура;
        СтруктураФО.Вставить("Пользователь", ПараметрыСеанса.ТекущийПользователь);
        СтруктураФО.Вставить("Период", Объект.Дата);  
        
        // Здесь именно "...ОпцийФормы()"
        УстановитьПараметрыФункциональныхОпцийФормы(СтруктураФО);
    КонецПроцедуры
    ```


### Доступ к установке права на просмотр поля **Старший менеджер**

За основу можно взять [создание пользователей и ролей](уф%20общее.md#user-creation). Можно сделать `Полные права` (доступно всё) и `Просмотр` (только просмотр).

