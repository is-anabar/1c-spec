# Что обязательно нужно сделать

## Содержание
- [Общее](#common)
	- [Проверка заполнения](#common-fill-check)
	- [Алгоритм записи движений](#common-docs-records)
	- [Блокировки](#common-block)
	- [На какое время брать данные из регистров при списании](#common-records-time)
	- [Индексация таблиц](#common-table-indexes)
	- [Представление номенклатуры](#common-table-indexes)
	- [Проблема копеек](#common-cents)
	- [Особенности работы с левым соединением](#common-left-join)
- [Оперативный учет](#ou)
	- [Использование старой методики для расчета себестоимости](#ou-old-method)
	- [Использование новой методики для расчета себестоимости](#ou-new-method)
	- [Создание отдельного регистра для отчета продаж](#ou-sales-register)
- [Бухгалтерский учет](#bu)
	- [Настройка планов счетов Управленческий](#bu-accounting-plan)
	- [Заполнение регистра бухгалтерии](#bu-accounting-register)
	- [Документ Операция](#bu-operation)
	- [Работа с блокировками и запросами](#bu-queries)
- [Сложные периодические расчеты](#spr)
	- [Заполнение регистров расчета](#spr-salary-register)
	- [Обработка Графики работы](#spr-data-processor-shifts)
	- [Базовые измерения](#spr-base-dimensions)
	- [Ошибки и их исправление](#spr-errors)

## <a name="common"></a>Общее

### <a name="common-fill-check"></a>Проверка заполнения
Устанавливать **Проверку заполнения** или аналоги для ключевых реквизитов и табличных частей/измерений


### <a name="common-docs-records"></a>Алгоритм записи движений

Установка флагов на запись движений:
- Для старой методики: в самом начале "Записывать = Истина" + "Записать()" + "Записывать = Истина"
- Для новой методики: "Записывать = Истина" + "Записать()" (после формирования предварительных движений)


### <a name="common-block"></a>Блокировки 

- Для старой методики: с помощью блокировки данных, **до запроса**
- Для новой: с помощью `БлокироватьДляИзменения`, после предварительной записи в регистр, **до контроля отрицательных остатков**

### <a name="common-records-time"></a>На какое время брать данные из регистров при списании
- Для старой методики: `МоментВремени()`
- Для новой: формирование движение - "Дата", контроль остатков - `Новый Граница(МоментВремени(), ВидГраницы.Включая)`

### <a name="common-table-indexes"></a>Индексация таблиц

Для полей левого соединения или полей типа `Номенклатура В (Выбрать Т.Номенклатура из втТЧТовары КАК Т))`

### <a name="common-presentation"></a>Представление номенклатуры

Чтобы не словить ошибку `Запрос в цикле` в случае вроде:
```1c
Пока Выборка.Следующий() Цикл
	Сообщить(Выборка.Номенклатура.Наименование);
	// аналогично Сообщить(Выборка.Номенклатура);
	// т.к. выполняется неявный вызов представления номенклатуры
КонецЦикла;
```

При выполнении **запроса** получаем `Номенклатура.Представление` и выводим его
```1c
Пока Выборка.Следующий() Цикл
	Сообщить(Выборка.НоменклатураПредставление);
КонецЦикла;

```
### <a name="common-cents"></a>Проблема копеек

Проблема копеек: проверяем на полное/последнее списание

### <a name="common-left-join"></a>Особенности работы с левым соединением

- ЕСТЬNULL() для левых и полных соединений для числовых значений (т.к. с ними будут арифметические операции)
- Если делать левое соединение, и по правой таблице делать отбор, то соединение становится внутренним (леонтьев, занятие 23, примерно 12 минута). 
	- Чтобы соединение осталось левым, надо прописать отбор в условии соединения
	- Иногда условие в объединении не приносит результата, нужно делать временные таблицы и соединяться по ним


## <a name="ou"></a>ОУ


### <a name="ou-old-method"></a>Использование старой методики для расчета себестоимости

Себестоимость и распределение денег по какому-либо порядку (фифо/лифо, по партиям, проектам и пр.) считается по `старой методике`. 

### <a name="ou-new-method"></a>Использование новой методики для расчета себестоимости

Просто списания (отдельно от расчета себестоимости/распредения) можно расчитывать по `новой методике`.

### <a name="ou-sales-register"></a>Создание отдельного регистра для отчета продаж

Условия, по которым нужно делать выбор в пользу `отдельного оборотного регистра` для отчета по продажам:
- остатки ведутся в одном разрезе (например, партия), а отчет по продажам явно не использует такие же разрезы (не использует партию)
- в отчете не нужны начальный и конечный остатки
- остатки номенклатуры не содержит данных по услугам, а в отчете по продажам услуги есть



## <a name="bu"></a>БУ

### <a name="bu-accounting-plan"></a>Настройка планов счетов Управленческий

-План счетов "Управленческий" (в каркасной конфигурации уже есть)
- На вкладке "Субконто" указать "Виды субконто" - план видов характеристик "ВидыСубконто" (в каркасной конфигурации уже есть)
- Указываем максимальное количество субконто (по необходимости, но больше 3 максимальное не рекомендуется)
- Признаки учета (флажок для всего счета). Связывается в ресурсами регистра бухгалтерии через "Параметры субконто"
- Признаки учета субконто (флажок для субконто)
 
### <a name="bu-accounting-register"></a>Заполнение регистра бухгалтерии

Заполняем [по инструкции](/05%20как%20заполнить%20регистр%20бухгалтерии.md)

### <a name="bu-operation"></a>Документ Операция

Заполняем [по инструкции](/04%20как%20создать%20документ%20Операция%20или%20ее%20аналоги.md)

### <a name="bu-queries"></a>Работа с блокировками и запросами

- В блокировках обязательно указывать `счет`
- В запросах обязательно указывать `виды субконто`, если два соединения с регистром бухгалтерии - `2 разных массива субконто`
- В запросах в отчетах `по оборотам` - дополнительно `корреспондирующие счета`
- При обращении к субконто через точку (или в отчете СКД) выражать субконто к конкретному типу


## <a name="spr"></a>СПР

### <a name="spr-salary-register"></a>Заполнение регистров расчета

Заполняем [по инструкции](/06%20как%20заполнить%20планы%20и%20регистры%20расчета.md)

### <a name="spr-data-processor-shifts"></a>Обработка Графики работы

В ней есть 2 цикла, убираем первый (он изменяет существующие записи). 

Без певрого цикла будет легче исправлять обработку для условий, которые указаны в задаче (график работы, дни и пр.).

### <a name="spr-base-dimensions"></a>Базовые измерения

Измерения выставлять как базовые, если они используются для получения базы (т.е. на основе чего считается премия, больничный и пр.) 

### <a name="spr-errors"></a>Ошибки и их исправление

1. Необходим пересчет фактического периода действия: такое возникает, если перезаписываются измерения

